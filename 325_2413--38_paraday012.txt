After running the above playbook, youd see all your normal inventory groups, plus groups for architecture x i etc. depending on what kind of server architectures you use.
Multiple inventory sources mixing static and dynamic inventories
If you need to combine static and dynamic inventory, or even if you wish to use multiple dynamic inventories for example, if you are managing servers hosted by two different cloud providers, you can pass a directory to ansible or ansible playbook, and Ansible will combine the output of all the inventories both static and dynamic inside the directory:
One caveat Ansible ignores ini and backup files in the directory, but will attempt to parse every text file and execute every executable file in the directory dont leave random files in mixed inventory folders
Lets start working our own custom dynamic inventory script by outlining the basic JSON format Ansible expects:
Ansible expects a dictionary of groups with each group having a list of hosts, and group variables in the groups vars dictionary, and a meta dictionary that stores host variables for all hosts individually inside a hostvars dictionary.
When you return a meta dictionary in your inventory script, Ansible stores that data in its cache and doesnt call your inventory script N times for all the hosts in the inventory. You can leave out the meta a variables if youd rather structure your inventory file to return host variables one host at a time Ansible will call your script with the arguments host hostname for each host, but its often faster and easier to simply return all variables in the first call. In this book, all the examples will use the meta dictionary.
