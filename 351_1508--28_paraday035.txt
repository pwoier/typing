Ephemeral infrastructure: Dynamic inventory
In many circumstances, static inventories are adequate for describing your infrastructure. When working on small applications, low traffic web applications, individual workstations, its simple enough to manage an inventory file by hand.
However, in the age of cloud computing and highly scalable application architecture, its often necessary to add dozens or hundreds of servers to an infrastructure in a short period of time or to add and remove servers continuously, to scaleas traffic grows and subsides. In this circumstance, it would be tedious if not impossible to manage a single inventory file by hand, especially if youre using auto scaling infrastructure new instances are provisioned and need to be configured in minutes or seconds.
Even in the case of container based infrastructure, new instances need to be configured correctly, with the proper port mappings, application settings, and filesystem configuration.
For these situations, Ansible allows you to define inventory dynamically. If youre using one of the larger cloud based hosting providers, chances are there is already a dynamic inventory script which Ansible uses to build an inventory for you to use. Ansible core already includes scripts for Amazon Web Services, Cobbler, DigitalOcean, Linode, OpenStack, and other large providers, and later well explore creating our own dynamic inventory script if you arent using one of the major hosting providers or cloud management platforms.
If you run the same playbook again, it should report no changes the entire playbook is idempotent You might be starting to see just how powerful it is to have a tool as flexible as Ansible at your disposal; not only can you configure servers, you can create them singly, or dozens at a time, and configure them at once, And even if a ham fisted sysadmin jumps in and deletes an entire server, you can run the playbook again, and rest assured your server will be recreated and reconfigured exactly as it was when it was first set up.
Note that you might need to disable strict host key checking to get provisioning and instant configuration to work correctly, otherwise you may run into an error stating that Ansible cant connect to the new droplet the second play. To do this, add the line host key checking False under the section in your ansible.cfg file located in etc ansible by default.
You should normally leave host key checking enabled, but when rapidly building and destroying VMs for testing purposes, it is simplest to disable it temporarily.
DigitalOcean dynamic inventory with digital ocean.py
Install dopy via pip the DigitalOcean Python library pip install dopy.
Download the DigitalOcean dynamic inventory script from Ansible on GitHub curl Ohttps:raw.githubusercontent.com ansible devel plugins inventory digital ocean.py
Make the inventory script executabel chmod x digital ocean.py
Make sure you have the credentials configured in digital ocean.ini as explained earlier
